{% extends 'base.html' %}
{% load static %}

{% block extra_head %}
<style>
    .modal-table-wrapper {
    max-height: 60vh;
    overflow-y: auto;
}

.modal-table th {
    position: sticky;
    top: 0;
    background: white;
    z-index: 1;
}
</style>
{% endblock %}



{% block content %}
<div class="min-h-screen bg-gradient-to-br from-green-50 via-emerald-100 to-teal-100">
    <!-- Hero Section -->
    <div class="max-w-6xl mx-auto px-4 py-10">
        <div class="bg-white rounded-xl shadow-xl overflow-hidden">
            <div class="md:flex">
                <!-- Left Content -->
                <div class="p-8 md:w-3/5">
                    <h2 class="text-3xl font-bold text-gray-800 mb-4">Welcome to NaijaPlate</h2>
                    <p class="text-gray-600 mb-6 text-lg">
                        Your personal dashboard for authentic Nigerian and African-inspired meal planning. Discover traditional recipes, create personalized meal plans, and explore the rich culinary heritage of Nigeria.
                    </p>
                    <div class="flex flex-wrap gap-4">
                        <a href="{% url 'meal_generator' %}" 
                           class="bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white px-6 py-3 rounded-lg font-medium transition duration-300 shadow-md">
                            <i class="fas fa-utensils mr-2"></i>Generate Meal Plan
                        </a>
                        <a href="{% url 'recipe_list' %}" 
                           class="bg-white border-2 border-green-500 text-green-600 hover:bg-green-50 px-6 py-3 rounded-lg font-medium transition duration-300">
                            <i class="fas fa-book-open mr-2"></i>Browse Recipes
                        </a>
                    </div>
                </div>

<!-- Right Glassmorphism Panel -->
<div class="md:w-2/5 relative">
    <!-- Glass Background -->
    <div class="absolute inset-0 rounded-lg" style="
        background: rgba(14, 159, 110, 0.7);
        backdrop-filter: blur(4px);
        -webkit-backdrop-filter: blur(4px);
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.18);
    "></div>

    <!-- Content Overlay (isolated from glass effect) -->
    <div class="relative z-10 h-full flex flex-col items-center justify-center">
        <!-- Text Container -->
        <div class="bg-green/100 backdrop-blur-none p-4 rounded-lg  text-center">
            <i class="fas fa-plate-wheat text-white text-7xl mb-6"></i>
            <h3 class="text-white text-2xl font-extrabold mb-2">Nigerian Cuisine</h3>
            <p class="text-white text-lg font-medium">Discover authentic flavors from home</p>
        </div>
    </div>
</div>
            </div>
        </div>
    </div>

    <!-- Feature Cards -->
    <div class="max-w-6xl mx-auto px-4 py-8">
        <h3 class="text-2xl font-bold text-gray-800 mb-6">Quick Access</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Meal Plans -->
            <div class="bg-white rounded-xl shadow-md hover:shadow-lg transition-shadow p-6 border-t-4 border-green-500">
                <div class="flex items-center justify-center h-12 w-12 rounded-full bg-green-100 text-green-600 mb-4">
                    <i class="fas fa-calendar-week text-2xl"></i>
                </div>
                <h4 class="text-xl font-semibold text-gray-800 mb-2">Weekly Meal Plans</h4>
                <p class="text-gray-600 mb-4">Customize meal plans with cultural authenticity and dietary preferences.</p>
                <a href="{% url 'meal_generator' %}" class="text-green-600 hover:text-green-700 font-medium">
                    Create Plan <i class="fas fa-arrow-right ml-1"></i>
                </a>
            </div>

            <!-- Shopping List -->
            <div class="bg-white rounded-xl shadow-md hover:shadow-lg transition-shadow p-6 border-t-4 border-emerald-500">
                <div class="flex items-center justify-center h-12 w-12 rounded-full bg-emerald-100 text-emerald-600 mb-4">
                    <i class="fas fa-shopping-basket text-2xl"></i>
                </div>
                <h4 class="text-xl font-semibold text-gray-800 mb-2">Smart Shopping Lists</h4>
                <p class="text-gray-600 mb-4">Generate location-aware shopping lists with Nigerian ingredients prioritized.</p>
                <a href="#" class="text-emerald-600 hover:text-emerald-700 font-medium">
                    View List <i class="fas fa-arrow-right ml-1"></i>
                </a>
            </div>

            <!-- Recipe Library -->
            <div class="bg-white rounded-xl shadow-md hover:shadow-lg transition-shadow p-6 border-t-4 border-teal-500">
                <div class="flex items-center justify-center h-12 w-12 rounded-full bg-teal-100 text-teal-600 mb-4">
                    <i class="fas fa-fire-alt text-2xl"></i>
                </div>
                <h4 class="text-xl font-semibold text-gray-800 mb-2">Recipe Library</h4>
                <p class="text-gray-600 mb-4">Over 200+ authentic Nigerian recipes with video tutorials and ingredient substitutions.</p>
                <a href="{% url 'recipe_list' %}" class="text-teal-600 hover:text-teal-700 font-medium">
                    Explore <i class="fas fa-arrow-right ml-1"></i>
                </a>
            </div>
        </div>
    </div>



    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-12 mt-12">
        <div class="max-w-6xl mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between gap-8">
                <!-- Brand -->
                <div class="mb-6 md:mb-0">
                    <h4 class="text-2xl font-extrabold mb-2">NaijaPlate</h4>
                    <p class="text-gray-400">Bringing Nigerian flavors to your kitchen with AI-powered meal solutions</p>
                </div>

                <!-- Links -->
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <h5 class="text-lg font-medium mb-2">Quick Links</h5>
                        <ul class="space-y-2">
                            <li><a href="#" class="text-gray-400 hover:text-white transition">Home</a></li>
                            <li><a href="#" class="text-gray-400 hover:text-white transition">Meal Plans</a></li>
                            <li><a href="#" class="text-gray-400 hover:text-white transition">Recipes</a></li>
                        </ul>
                    </div>
                    <div>
                        <h5 class="text-lg font-medium mb-2">Support</h5>
                        <ul class="space-y-2">
                            <li><a href="#" class="text-gray-400 hover:text-white transition">Contact Us</a></li>
                            <li><a href="#" class="text-gray-400 hover:text-white transition">FAQ</a></li>
                            <li><a href="#" class="text-gray-400 hover:text-white transition">Privacy Policy</a></li>
                        </ul>
                    </div>
                </div>

                <!-- Social Icons -->
                <div class="flex items-center gap-4">
                    <a href="#" class="text-gray-400 hover:text-white transition"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="text-gray-400 hover:text-white transition"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="text-gray-400 hover:text-white transition"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-12 pt-6 text-center text-gray-400 text-sm">
                &copy; 2025 NaijaPlate. All rights reserved.
            </div>
        </div>
    </footer>
</div>

<script>

function shareMealPlanOnWhatsApp() {
    const mealPlanTable = document.getElementById('mealPlanTable');
    if (!mealPlanTable) {
        alert('No meal plan available to share.');
        return;
    }

    // Extract meal plan details from the table
    let message = "ðŸ½ï¸ *My NaijaPlate Meal Plan*:\n\n";
    const rows = mealPlanTable.querySelectorAll('tr');
    rows.forEach((row, index) => {
        if (index === 0) return; // Skip the header row
        const cells = row.querySelectorAll('td');
        if (cells.length === 5) {
            const day = cells[0].innerText.trim();
            const breakfast = cells[1].innerText.trim();
            const lunch = cells[2].innerText.trim();
            const snack = cells[3].innerText.trim();
            const dinner = cells[4].innerText.trim();

            message += `ðŸ“… *${day}*\n`;
            message += `ðŸŒ… *Breakfast*: ${breakfast || 'N/A'}\n`;
            message += `ðŸ½ï¸ *Lunch*: ${lunch || 'N/A'}\n`;
            if (snack) {
                message += `ðŸ¥¨ *Snack*: ${snack || 'N/A'}\n`;
            }
            message += `ðŸŒ™ *Dinner*: ${dinner || 'N/A'}\n\n`;
        }
    });

    message += "ðŸ“± Generated by *NaijaPlate*";

    // Encode the message for WhatsApp
    const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
    window.open(whatsappUrl, '_blank');
}



function viewActivityDetails(activityId) {
    fetch(`/activity/${activityId}/detail/`)
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.json();
        })
        .then(data => {
            console.log('Activity data:', data); // For debugging

            // Basic activity information
            let contentHtml = `
                <div class="bg-gray-50 p-4 rounded-lg">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <p class="text-sm text-gray-600">Action</p>
                            <p class="font-medium">${data.action}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Time</p>
                            <p class="font-medium">${data.timestamp}</p>
                        </div>
                    </div>
                </div>
            `;

            // If there's a meal plan, display it with recipe links
            if (data.meal_plan && data.meal_plan.days) {
                document.getElementById('mealPlanContent').classList.remove('hidden');
                let mealPlanHtml = '';
                
                data.meal_plan.days.forEach((day, index) => {
                    mealPlanHtml += `
                        <tr class="border-b hover:bg-gray-50">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                ${day.day}
                            </td>
                            ${['breakfast', 'lunch', 'snack', 'dinner'].map(mealType => `
                                <td class="px-6 py-4 text-sm text-gray-500">
                                    <div class="flex flex-col gap-2">
                                        <span>${day.meals[mealType] || '-'}</span>
                                        ${day.meals[`${mealType}_recipe`] ? `
                                            <button onclick="viewRecipe(${day.meals[`${mealType}_recipe`]})" 
                                                    class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded hover:bg-green-200">
                                                <i class="fas fa-utensils mr-1"></i>View Recipe
                                            </button>
                                        ` : ''}
                                    </div>
                                </td>
                            `).join('')}
                        </tr>
                    `;
                });
                
                document.getElementById('mealPlanTable').innerHTML = mealPlanHtml;
            } else {
                document.getElementById('mealPlanContent').classList.add('hidden');
            }

            // Update modal content
            document.getElementById('modalContent').innerHTML = contentHtml;
            document.getElementById('activityModal').classList.remove('hidden');
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error loading activity details');
        });
}


function viewRecipe(recipeId) {
    console.log('Viewing recipe:', recipeId);
    window.location.href = `/recipes/${recipeId}/`;
}


function exportActivityPDF() {
    const activityId = document.getElementById('activityModal').dataset.activityId;
    window.location.href = `/activity/${activityId}/export/`;
}

function closeModal() {
    document.getElementById('activityModal').classList.add('hidden');
}

// Close modal when clicking outside
document.getElementById('activityModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeModal();
    }
});


</script>
{% endblock %}